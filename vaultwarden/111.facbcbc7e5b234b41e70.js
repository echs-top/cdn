"use strict";(self.webpackChunk_bitwarden_web_vault=self.webpackChunk_bitwarden_web_vault||[]).push([[111],{25111:(t,e,i)=>{i.d(e,{Y:()=>rt});var o,n=i(99042),r=i(24852),s=i(98645),c=i(54019),l=i(35406),a=i(92786),p=i(68362),u=i(62324),d=i(53634),f=i(58691),h=i(20099),g=i(87264),y=i(27646);!function(t){t[t.AccountEncrypted=0]="AccountEncrypted",t[t.FileEncrypted=1]="FileEncrypted"}(o||(o={}));var m=i(85958),x=i(56945),v=i(78627),b=i(99721),w=i(87483),_=i(83924),U=i(66459),Z=i(42304),E=i(53481),F=i(73369),T=function(t,e,i,o){return new(i||(i=Promise))((function(n,r){function s(t){try{l(o.next(t))}catch(e){r(e)}}function c(t){try{l(o.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,c)}l((o=o.apply(t,e||[])).next())}))};class A{get disabledByPolicy(){return this._disabledByPolicy}constructor(t,e,i,n,l,a,p,u,d,f,h){this.i18nService=t,this.platformUtilsService=e,this.exportService=i,this.eventCollectionService=n,this.policyService=l,this.logService=a,this.userVerificationService=p,this.formBuilder=u,this.fileDownloadService=d,this.dialogService=f,this.organizationService=h,this.onSaved=new r.vpe,this.filePasswordValue=null,this._disabledByPolicy=!1,this.organizationId=null,this.exportForm=this.formBuilder.group({vaultSelector:["myVault",{nonNullable:!0,validators:[s.kI.required]}],format:["json",s.kI.required],secret:[""],filePassword:["",s.kI.required],confirmFilePassword:["",s.kI.required],fileEncryptionType:[o.AccountEncrypted]}),this.formatOptions=[{name:".json",value:"json"},{name:".csv",value:"csv"},{name:".json (Encrypted)",value:"encrypted_json"}],this.destroy$=new c.x}ngOnInit(){return T(this,void 0,void 0,(function*(){this.organizations$=(0,l.z)(this.organizationService.memberOrganizations$.pipe((0,f.EC)(this.i18nService),(0,a.U)((t=>t.sort(y.c.getSortFunction(this.i18nService,"name")))))),this.policyService.policyAppliesToActiveUser$(h.Mi.DisablePersonalVaultExport).pipe((0,p.R)(this.destroy$)).subscribe((t=>{this._disabledByPolicy=t,this.disabledByPolicy&&this.exportForm.disable()})),this.organizationId?(this.exportForm.controls.vaultSelector.patchValue(this.organizationId),this.exportForm.controls.vaultSelector.disable()):(this.exportForm.controls.vaultSelector.valueChanges.pipe((0,p.R)(this.destroy$)).subscribe((t=>{this.organizationId="myVault"!=t?t:void 0})),this.exportForm.controls.vaultSelector.setValue("myVault")),(0,u.T)(this.exportForm.get("format").valueChanges,this.exportForm.get("fileEncryptionType").valueChanges).pipe((0,p.R)(this.destroy$)).pipe((0,d.O)(0)).subscribe((()=>this.adjustValidators()))}))}ngOnDestroy(){this.destroy$.next()}get encryptedFormat(){return"encrypted_json"===this.format}doExport(){return T(this,void 0,void 0,(function*(){try{this.formPromise=this.getExportData();const t=yield this.formPromise;this.downloadFile(t),this.saved(),yield this.collectEvent(),this.exportForm.get("secret").setValue(""),this.exportForm.clearValidators()}catch(t){this.logService.error(t)}}))}submit(){return T(this,void 0,void 0,(function*(){if(this.disabledByPolicy)return void this.platformUtilsService.showToast("error",null,this.i18nService.t("personalVaultExportPolicyInEffect"));if(!(yield this.warningDialog()))return;const t=this.exportForm.get("secret").value;try{yield this.userVerificationService.verifyUser(t)}catch(e){return void this.platformUtilsService.showToast("error",this.i18nService.t("errorOccurred"),e.message)}this.doExport()}))}warningDialog(){return T(this,void 0,void 0,(function*(){return this.encryptedFormat?yield this.dialogService.openSimpleDialog({title:{key:"confirmVaultExport"},content:this.i18nService.t("encExportKeyWarningDesc")+" "+this.i18nService.t("encExportAccountWarningDesc"),acceptButtonText:{key:"exportVault"},type:"warning"}):yield this.dialogService.openSimpleDialog({title:{key:"confirmVaultExport"},content:{key:"exportWarningDesc"},acceptButtonText:{key:"exportVault"},type:"warning"})}))}saved(){this.onSaved.emit()}getExportData(){return"encrypted_json"===this.format&&this.fileEncryptionType===o.FileEncrypted?this.exportService.getPasswordProtectedExport(this.filePassword):this.exportService.getExport(this.format,null)}getFileName(t){let e=this.format;return"encrypted_json"===this.format&&(t=null==t?"encrypted":"encrypted_"+t,e="json"),this.exportService.getFileName(t,e)}collectEvent(){return T(this,void 0,void 0,(function*(){yield this.eventCollectionService.collect(g.tw.User_ClientExportedVault)}))}get format(){return this.exportForm.get("format").value}get filePassword(){return this.exportForm.get("filePassword").value}get confirmFilePassword(){return this.exportForm.get("confirmFilePassword").value}get fileEncryptionType(){return this.exportForm.get("fileEncryptionType").value}adjustValidators(){this.exportForm.get("confirmFilePassword").reset(),this.exportForm.get("filePassword").reset(),this.encryptedFormat&&this.fileEncryptionType==o.FileEncrypted?(this.exportForm.controls.filePassword.enable(),this.exportForm.controls.confirmFilePassword.enable()):(this.exportForm.controls.filePassword.disable(),this.exportForm.controls.confirmFilePassword.disable())}downloadFile(t){const e=this.getFileName();this.fileDownloadService.download({fileName:e,blobData:t,blobOptions:{type:"text/plain"}})}}A.ɵfac=function(t){return new(t||A)(r.Y36(v.D),r.Y36(b.P),r.Y36(m.qX),r.Y36(w.j),r.Y36(_.d),r.Y36(U.$),r.Y36(Z.i),r.Y36(s.QS),r.Y36(E._),r.Y36(F.x),r.Y36(f.Mn))},A.ɵdir=r.lG2({type:A,viewQuery:function(t,e){if(1&t&&r.Gf(x.Z,5),2&t){let t;r.iGM(t=r.CRH())&&(e.passwordStrengthComponent=t.first)}},outputs:{onSaved:"onSaved"}});var S=i(59281),P=i(4519),q=i(23915),I=i(19419),O=i(24610),Y=i(90258),C=i(81974),V=i(24083),z=i(24637),D=i(11512),Q=i(54666),J=i(1e4),N=i(36179),j=i(44358),k=i(21656),B=i(21500),L=i(66079),$=i(28975),M=i(30469),G=i(28315),H=i(82933),R=function(t,e,i,o){return new(i||(i=Promise))((function(n,r){function s(t){try{l(o.next(t))}catch(e){r(e)}}function c(t){try{l(o.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,c)}l((o=o.apply(t,e||[])).next())}))};function W(t,e){1&t&&(r.TgZ(0,"bit-callout",10),r.ALo(1,"i18n"),r._uU(2),r.ALo(3,"i18n"),r.qZA()),2&t&&(r.s9C("title",r.lcZ(1,2,"vaultExportDisabled")),r.xp6(2),r.hij("\n    ",r.lcZ(3,4,"personalVaultExportPolicyInEffect"),"\n  "))}function K(t,e){if(1&t&&r._UZ(0,"app-export-scope-callout",11),2&t){const t=r.oxw(2);r.Q6J("organizationId",t.organizationId)}}function X(t,e){if(1&t&&r._UZ(0,"bit-option",15),2&t){const t=e.$implicit;r.Q6J("value",t.id)("label",t.name)}}function tt(t,e){if(1&t&&(r.TgZ(0,"bit-form-field"),r._uU(1,"\n    "),r.TgZ(2,"bit-label"),r._uU(3),r.ALo(4,"i18n"),r.qZA(),r._uU(5,"\n    "),r.TgZ(6,"bit-select",12),r._uU(7,"\n      "),r._UZ(8,"bit-option",13),r.ALo(9,"i18n"),r._uU(10,"\n      "),r.YNc(11,X,1,2,"bit-option",14),r.ALo(12,"async"),r._uU(13,"\n    "),r.qZA(),r._uU(14,"\n  "),r.qZA()),2&t){const t=r.oxw(2);r.xp6(3),r.Oqu(r.lcZ(4,3,"exportFrom")),r.xp6(5),r.Q6J("label",r.lcZ(9,5,"myVault")),r.xp6(3),r.Q6J("ngForOf",r.lcZ(12,7,t.organizations$))}}function et(t,e){if(1&t&&r._UZ(0,"bit-option",16),2&t){const t=e.$implicit;r.Q6J("value",t.value)("label",t.name)}}function it(t,e){if(1&t){const t=r.EpF();r.ynx(0),r._uU(1,"\n      "),r.TgZ(2,"div",20),r._uU(3,"\n        "),r.TgZ(4,"bit-form-field"),r._uU(5,"\n          "),r.TgZ(6,"bit-label"),r._uU(7),r.ALo(8,"i18n"),r.qZA(),r._uU(9,"\n          "),r._UZ(10,"input",21),r._uU(11,"\n          "),r.TgZ(12,"button",22),r.NdJ("toggledChange",(function(e){r.CHM(t);const i=r.oxw(3);return r.KtG(i.showFilePassword=e)})),r.qZA(),r._uU(13,"\n          "),r.TgZ(14,"bit-hint"),r._uU(15),r.ALo(16,"i18n"),r.qZA(),r._uU(17,"\n        "),r.qZA(),r._uU(18,"\n        "),r.TgZ(19,"app-password-strength",23),r._uU(20," "),r.qZA(),r._uU(21,"\n      "),r.qZA(),r._uU(22,"\n      "),r.TgZ(23,"bit-form-field"),r._uU(24,"\n        "),r.TgZ(25,"bit-label"),r._uU(26),r.ALo(27,"i18n"),r.qZA(),r._uU(28,"\n        "),r._UZ(29,"input",24),r._uU(30,"\n        "),r.TgZ(31,"button",22),r.NdJ("toggledChange",(function(e){r.CHM(t);const i=r.oxw(3);return r.KtG(i.showFilePassword=e)})),r.qZA(),r._uU(32,"\n      "),r.qZA(),r._uU(33,"\n    "),r.BQk()}if(2&t){const t=r.oxw(3);r.xp6(7),r.Oqu(r.lcZ(8,7,"filePassword")),r.xp6(5),r.Q6J("toggled",t.showFilePassword),r.xp6(3),r.Oqu(r.lcZ(16,9,"exportPasswordDescription")),r.xp6(4),r.Q6J("password",t.filePassword)("showText",!0),r.xp6(7),r.Oqu(r.lcZ(27,11,"confirmFilePassword")),r.xp6(5),r.Q6J("toggled",t.showFilePassword)}}function ot(t,e){if(1&t&&(r.ynx(0),r._uU(1,"\n    "),r.TgZ(2,"bit-radio-group",17),r._uU(3,"\n      "),r.TgZ(4,"bit-label"),r._uU(5),r.ALo(6,"i18n"),r.qZA(),r._uU(7,"\n\n      "),r.TgZ(8,"bit-radio-button",18),r._uU(9,"\n        "),r.TgZ(10,"bit-label"),r._uU(11),r.ALo(12,"i18n"),r.qZA(),r._uU(13,"\n        "),r.TgZ(14,"bit-hint"),r._uU(15),r.ALo(16,"i18n"),r.qZA(),r._uU(17,"\n      "),r.qZA(),r._uU(18,"\n\n      "),r.TgZ(19,"bit-radio-button",19),r._uU(20,"\n        "),r.TgZ(21,"bit-label"),r._uU(22),r.ALo(23,"i18n"),r.qZA(),r._uU(24,"\n        "),r.TgZ(25,"bit-hint"),r._uU(26),r.ALo(27,"i18n"),r.qZA(),r._uU(28,"\n      "),r.qZA(),r._uU(29,"\n    "),r.qZA(),r._uU(30,"\n\n    "),r.YNc(31,it,34,13,"ng-container",6),r._uU(32,"\n  "),r.BQk()),2&t){const t=r.oxw(2);r.xp6(5),r.Oqu(r.lcZ(6,8,"exportTypeHeading")),r.xp6(3),r.Q6J("value",t.encryptedExportType.AccountEncrypted),r.xp6(3),r.Oqu(r.lcZ(12,10,"accountRestricted")),r.xp6(4),r.Oqu(r.lcZ(16,12,"accountRestrictedOptionDescription")),r.xp6(4),r.Q6J("value",t.encryptedExportType.FileEncrypted),r.xp6(3),r.Oqu(r.lcZ(23,14,"passwordProtected")),r.xp6(4),r.Oqu(r.lcZ(27,16,"passwordProtectedOptionDescription")),r.xp6(5),r.Q6J("ngIf",t.fileEncryptionType==t.encryptedExportType.FileEncrypted)}}function nt(t,e){if(1&t){const t=r.EpF();r.TgZ(0,"form",1,2),r.NdJ("ngSubmit",(function(){r.CHM(t);const e=r.oxw();return r.KtG(e.submit())})),r._uU(2,"\n  "),r.TgZ(3,"h1",3),r._uU(4),r.ALo(5,"i18n"),r.qZA(),r._uU(6,"\n\n  "),r.YNc(7,W,4,6,"bit-callout",4),r._uU(8,"\n  "),r.YNc(9,K,1,1,"app-export-scope-callout",5),r._uU(10,"\n\n  "),r.YNc(11,tt,15,9,"bit-form-field",6),r.ALo(12,"async"),r._uU(13,"\n\n  "),r.TgZ(14,"bit-form-field"),r._uU(15,"\n    "),r.TgZ(16,"bit-label"),r._uU(17),r.ALo(18,"i18n"),r.qZA(),r._uU(19,"\n    "),r.TgZ(20,"bit-select",7),r._uU(21,"\n      "),r.YNc(22,et,1,2,"bit-option",8),r._uU(23,"\n    "),r.qZA(),r._uU(24,"\n  "),r.qZA(),r._uU(25,"\n\n  "),r.YNc(26,ot,33,18,"ng-container",6),r._uU(27,"\n\n  "),r.TgZ(28,"button",9),r._uU(29),r.ALo(30,"i18n"),r.qZA(),r._uU(31,"\n"),r.qZA()}if(2&t){const t=r.MAs(1),e=r.oxw();r.Q6J("appApiAction",e.formPromise)("formGroup",e.exportForm),r.xp6(4),r.Oqu(r.lcZ(5,12,"exportVault")),r.xp6(3),r.Q6J("ngIf",e.disabledByPolicy),r.xp6(2),r.Q6J("ngIf",!e.disabledByPolicy),r.xp6(2),r.Q6J("ngIf",r.lcZ(12,14,e.flexibleCollectionsEnabled$)),r.xp6(6),r.Oqu(r.lcZ(18,16,"fileFormat")),r.xp6(5),r.Q6J("ngForOf",e.formatOptions),r.xp6(4),r.Q6J("ngIf","encrypted_json"===e.format),r.xp6(2),r.Q6J("loading",t.loading)("disabled",e.disabledByPolicy),r.xp6(1),r.hij("\n    ",r.lcZ(30,18,"confirmFormat"),"\n  ")}}class rt extends A{constructor(t,e,i,n,r,s,c,l,a,p,u,d){super(t,e,i,n,r,s,c,l,a,p,u),this.configService=d,this.encryptedExportType=o,this.flexibleCollectionsEnabled$=this.configService.getFeatureFlag$(S.T.FlexibleCollections,!1)}submit(){return R(this,void 0,void 0,(function*(){if(this.isFileEncryptedExport&&this.filePassword!=this.confirmFilePassword)return void this.platformUtilsService.showToast("error",this.i18nService.t("errorOccurred"),this.i18nService.t("filePasswordAndConfirmFilePasswordDoNotMatch"));if(this.exportForm.markAllAsTouched(),!this.exportForm.valid)return;if(this.disabledByPolicy)return void this.platformUtilsService.showToast("error",null,this.i18nService.t("personalVaultExportPolicyInEffect"));(yield this.verifyUser())&&this.doExport()}))}saved(){super.saved(),this.platformUtilsService.showToast("success",null,this.i18nService.t("exportSuccess"))}verifyUser(){let t="exportWarningDesc";this.isFileEncryptedExport?t="fileEncryptedExportWarningDesc":this.isAccountEncryptedExport&&(t="encExportKeyWarningDesc");const e=(0,P.CV)(this.dialogService,{data:{confirmDescription:t,confirmButtonText:"exportVault",modalTitle:"confirmVaultExport"}});if(null!=e)return(0,n.z)(e.closed)}get isFileEncryptedExport(){return"encrypted_json"===this.format&&this.fileEncryptionType===o.FileEncrypted}get isAccountEncryptedExport(){return"encrypted_json"===this.format&&this.fileEncryptionType===o.AccountEncrypted}}rt.ɵfac=function(t){return new(t||rt)(r.Y36(v.D),r.Y36(b.P),r.Y36(m.qX),r.Y36(w.j),r.Y36(_.d),r.Y36(U.$),r.Y36(Z.i),r.Y36(s.QS),r.Y36(E._),r.Y36(F.x),r.Y36(f.Mn),r.Y36(q.i))},rt.ɵcmp=r.Xpm({type:rt,selectors:[["app-export"]],features:[r.qOj],decls:2,vars:1,consts:[[3,"appApiAction","formGroup","ngSubmit",4,"ngIf"],[3,"appApiAction","formGroup","ngSubmit"],["form",""],["bitTypography","h1"],["type","danger",3,"title",4,"ngIf"],[3,"organizationId",4,"ngIf"],[4,"ngIf"],["formControlName","format"],[3,"value","label",4,"ngFor","ngForOf"],["bitButton","","type","submit","buttonType","primary",3,"loading","disabled"],["type","danger",3,"title"],[3,"organizationId"],["formControlName","vaultSelector"],["value","myVault","icon","bwi-user",3,"label"],["icon","bwi-business",3,"value","label",4,"ngFor","ngForOf"],["icon","bwi-business",3,"value","label"],[3,"value","label"],["formControlName","fileEncryptionType","aria-label","exportTypeHeading"],["id","AccountEncrypted","name","fileEncryptionType","checked","fileEncryptionType === encryptedExportType.AccountEncrypted",1,"tw-block",3,"value"],["id","FileEncrypted","name","fileEncryptionType","checked","fileEncryptionType === encryptedExportType.FileEncrypted",1,"tw-block",3,"value"],[1,"tw-mb-3"],["bitInput","","type","password","id","filePassword","formControlName","filePassword","name","password"],["type","button","bitSuffix","","bitIconButton","","bitPasswordInputToggle","",3,"toggled","toggledChange"],[3,"password","showText"],["bitInput","","type","password","id","confirmFilePassword","formControlName","confirmFilePassword","name","confirmFilePassword"]],template:function(t,e){1&t&&(r.YNc(0,nt,32,20,"form",0),r._uU(1,"\n")),2&t&&r.Q6J("ngIf",e.exportForm)},dependencies:[I.sg,I.O5,s._Y,s.Fj,s.JJ,s.JL,s.sg,s.u,O.b,Y.N,x.Z,C.r,V.O,z.d,D.G,Q.w,J.e,N.u,j.M,k.Q,B._,L.w,$.H,M.x,G.t,I.Ov,H.C],encapsulation:2})},90258:(t,e,i)=>{i.d(e,{N:()=>u});var o=i(58691),n=i(24852),r=i(58172),s=i(19419),c=i(53707),l=i(82933),a=function(t,e,i,o){return new(i||(i=Promise))((function(n,r){function s(t){try{l(o.next(t))}catch(e){r(e)}}function c(t){try{l(o.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,c)}l((o=o.apply(t,e||[])).next())}))};function p(t,e){if(1&t&&(n.ynx(0),n._uU(1,"\n  "),n.TgZ(2,"app-callout",1),n.ALo(3,"i18n"),n._uU(4),n.ALo(5,"i18n"),n.qZA(),n._uU(6,"\n"),n.BQk()),2&t){const t=n.oxw();n.xp6(2),n.s9C("title",n.lcZ(3,2,t.scopeConfig.title)),n.xp6(2),n.hij("\n    ",n.xi3(5,4,t.scopeConfig.description,t.scopeConfig.scopeIdentifier),"\n  ")}}class u{get organizationId(){return this._organizationId}set organizationId(t){this._organizationId=t,this.getScopeMessage(this._organizationId)}constructor(t,e){this.organizationService=t,this.stateService=e,this.show=!1}ngOnInit(){return a(this,void 0,void 0,(function*(){this.organizationService.hasOrganizations()&&(yield this.getScopeMessage(this.organizationId),this.show=!0)}))}getScopeMessage(t){return a(this,void 0,void 0,(function*(){this.scopeConfig=null!=t?{title:"exportingOrganizationVaultTitle",description:"exportingOrganizationVaultDesc",scopeIdentifier:this.organizationService.get(t).name}:{title:"exportingPersonalVaultTitle",description:"exportingIndividualVaultDescription",scopeIdentifier:yield this.stateService.getEmail()}}))}}u.ɵfac=function(t){return new(t||u)(n.Y36(o.Mn),n.Y36(r.b))},u.ɵcmp=n.Xpm({type:u,selectors:[["app-export-scope-callout"]],inputs:{organizationId:"organizationId"},decls:2,vars:1,consts:[[4,"ngIf"],["type","info",3,"title"]],template:function(t,e){1&t&&(n.YNc(0,p,7,7,"ng-container",0),n._uU(1,"\n")),2&t&&n.Q6J("ngIf",e.show)},dependencies:[s.O5,c.O,l.C],encapsulation:2})}}]);
//# sourceMappingURL=111.facbcbc7e5b234b41e70.js.map