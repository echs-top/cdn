{"version":3,"file":"static/js/3953.09f46e39.chunk.js","mappings":"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","sources":["pages/Users/Login/index.tsx","../node_modules/.pnpm/react-bootstrap@2.10.6_@types+react@18.3.16_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/react-bootstrap/esm/Container.js"],"sourcesContent":["/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport React, { FormEvent, useState, useEffect } from 'react';\nimport { Container, Form, Button, Col } from 'react-bootstrap';\nimport { Link, useNavigate, useSearchParams } from 'react-router-dom';\nimport { Trans, useTranslation } from 'react-i18next';\n\nimport { usePageTags } from '@/hooks';\nimport type { LoginReqParams, FormDataType } from '@/common/interface';\nimport { Unactivate, WelcomeTitle, PluginRender } from '@/components';\nimport {\n  loggedUserInfoStore,\n  loginSettingStore,\n  userCenterStore,\n} from '@/stores';\nimport {\n  floppyNavigation,\n  guard,\n  handleFormError,\n  userCenter,\n  scrollToElementTop,\n} from '@/utils';\nimport { PluginType, useCaptchaPlugin } from '@/utils/pluginKit';\nimport { login, UcAgent } from '@/services';\nimport { setupAppTheme } from '@/utils/localize';\n\nconst Index: React.FC = () => {\n  const { t } = useTranslation('translation', { keyPrefix: 'login' });\n  const navigate = useNavigate();\n  const [searchParams] = useSearchParams();\n  const { user: storeUser, update: updateUser } = loggedUserInfoStore((_) => _);\n  const loginSetting = loginSettingStore((state) => state.login);\n  const ucAgent = userCenterStore().agent;\n  let ucAgentInfo: UcAgent['agent_info'] | undefined;\n  if (ucAgent?.enabled && ucAgent?.agent_info) {\n    ucAgentInfo = ucAgent.agent_info;\n  }\n  const canOriginalLogin =\n    (!ucAgentInfo || ucAgentInfo.enabled_original_user_system) &&\n    loginSetting.allow_password_login;\n\n  const [formData, setFormData] = useState<FormDataType>({\n    e_mail: {\n      value: '',\n      isInvalid: false,\n      errorMsg: '',\n    },\n    pass: {\n      value: '',\n      isInvalid: false,\n      errorMsg: '',\n    },\n  });\n\n  const [step, setStep] = useState(1);\n\n  const handleChange = (params: FormDataType) => {\n    setFormData({ ...formData, ...params });\n  };\n\n  const passwordCaptcha = useCaptchaPlugin('password');\n\n  const checkValidated = (): boolean => {\n    let bol = true;\n    const { e_mail, pass } = formData;\n\n    if (!e_mail.value) {\n      bol = false;\n      formData.e_mail = {\n        value: '',\n        isInvalid: true,\n        errorMsg: t('email.msg.empty'),\n      };\n    }\n\n    if (!pass.value) {\n      bol = false;\n      formData.pass = {\n        value: '',\n        isInvalid: true,\n        errorMsg: t('password.msg.empty'),\n      };\n    }\n\n    setFormData({\n      ...formData,\n    });\n    if (!bol) {\n      const errObj = Object.keys(formData).filter(\n        (key) => formData[key].isInvalid,\n      );\n      const ele = document.getElementById(errObj[0]);\n      scrollToElementTop(ele);\n    }\n\n    return bol;\n  };\n\n  const handleLogin = (event?: any) => {\n    if (event) {\n      event.preventDefault();\n    }\n    const params: LoginReqParams = {\n      e_mail: formData.e_mail.value,\n      pass: formData.pass.value,\n    };\n\n    const captcha = passwordCaptcha?.getCaptcha();\n    if (captcha?.verify) {\n      params.captcha_code = captcha.captcha_code;\n      params.captcha_id = captcha.captcha_id;\n    }\n\n    login(params)\n      .then(async (res) => {\n        await passwordCaptcha?.close?.();\n        updateUser(res);\n        setupAppTheme();\n        const userStat = guard.deriveLoginState();\n        if (userStat.isNotActivated) {\n          // inactive\n          setStep(2);\n        } else {\n          guard.handleLoginRedirect(navigate);\n        }\n      })\n      .catch((err) => {\n        if (err.isError) {\n          const data = handleFormError(err, formData);\n          setFormData({ ...data });\n          passwordCaptcha?.handleCaptchaError?.(err.list);\n          const ele = document.getElementById(err.list[0].error_field);\n          scrollToElementTop(ele);\n        }\n      });\n  };\n\n  const handleSubmit = async (event: FormEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n\n    if (!checkValidated()) {\n      return;\n    }\n\n    if (!passwordCaptcha) {\n      handleLogin();\n      return;\n    }\n\n    passwordCaptcha?.check?.(() => {\n      handleLogin();\n    });\n  };\n\n  useEffect(() => {\n    const isInactive = searchParams.get('status');\n\n    if (storeUser.id && (storeUser.mail_status === 2 || isInactive)) {\n      setStep(2);\n    }\n  }, []);\n\n  usePageTags({\n    title: t('login', { keyPrefix: 'page_title' }),\n  });\n\n  return (\n    <Container style={{ paddingTop: '4rem', paddingBottom: '5rem' }}>\n      <WelcomeTitle />\n      {step === 1 ? (\n        <Col className=\"mx-auto\" md={6} lg={4} xl={3}>\n          <PluginRender\n            type={PluginType.Captcha}\n            slug_name=\"captcha_basic\"\n            className=\"mb-5\"\n          />\n\n          <PluginRender\n            type={PluginType.Captcha}\n            slug_name=\"captcha_google_v2\"\n            className=\"mb-5\"\n          />\n          {ucAgentInfo ? (\n            <PluginRender\n              type={PluginType.Connector}\n              slug_name=\"hosting_connector\"\n              className=\"mb-5\"\n            />\n          ) : (\n            <PluginRender\n              type={PluginType.Connector}\n              slug_name=\"third_party_connector\"\n              className=\"mb-5\"\n            />\n          )}\n          {canOriginalLogin ? (\n            <>\n              <Form noValidate onSubmit={handleSubmit}>\n                <Form.Group controlId=\"email\" className=\"mb-3\">\n                  <Form.Label>{t('email.label')}</Form.Label>\n                  <Form.Control\n                    required\n                    tabIndex={1}\n                    type=\"email\"\n                    value={formData.e_mail.value}\n                    isInvalid={formData.e_mail.isInvalid}\n                    onChange={(e) =>\n                      handleChange({\n                        e_mail: {\n                          value: e.target.value,\n                          isInvalid: false,\n                          errorMsg: '',\n                        },\n                      })\n                    }\n                  />\n                  <Form.Control.Feedback type=\"invalid\">\n                    {formData.e_mail.errorMsg}\n                  </Form.Control.Feedback>\n                </Form.Group>\n\n                <Form.Group controlId=\"pass\" className=\"mb-3\">\n                  <div className=\"d-flex justify-content-between\">\n                    <Form.Label>{t('password.label')}</Form.Label>\n                    <Link to=\"/users/account-recovery\" tabIndex={2}>\n                      <small>{t('forgot_pass')}</small>\n                    </Link>\n                  </div>\n\n                  <Form.Control\n                    required\n                    tabIndex={1}\n                    type=\"password\"\n                    // value={formData.pass.value}\n                    isInvalid={formData.pass.isInvalid}\n                    onChange={(e) =>\n                      handleChange({\n                        pass: {\n                          value: e.target.value,\n                          isInvalid: false,\n                          errorMsg: '',\n                        },\n                      })\n                    }\n                  />\n                  <Form.Control.Feedback type=\"invalid\">\n                    {formData.pass.errorMsg}\n                  </Form.Control.Feedback>\n                </Form.Group>\n\n                <div className=\"d-grid\">\n                  <Button variant=\"primary\" type=\"submit\" tabIndex={1}>\n                    {t('login', { keyPrefix: 'btns' })}\n                  </Button>\n                </div>\n              </Form>\n              {loginSetting.allow_new_registrations && (\n                <div className=\"text-center mt-5\">\n                  <Trans i18nKey=\"login.info_sign\" ns=\"translation\">\n                    Don't have an account?\n                    <Link\n                      to={userCenter.getSignUpUrl()}\n                      tabIndex={2}\n                      onClick={floppyNavigation.handleRouteLinkClick}>\n                      Sign up\n                    </Link>\n                  </Trans>\n                </div>\n              )}\n            </>\n          ) : null}\n        </Col>\n      ) : null}\n\n      {step === 2 && <Unactivate visible={step === 2} />}\n    </Container>\n  );\n};\n\nexport default React.memo(Index);\n","\"use client\";\n\nimport classNames from 'classnames';\nimport * as React from 'react';\nimport { useBootstrapPrefix } from './ThemeProvider';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nconst Container = /*#__PURE__*/React.forwardRef(({\n  bsPrefix,\n  fluid = false,\n  // Need to define the default \"as\" during prop destructuring to be compatible with styled-components github.com/react-bootstrap/react-bootstrap/issues/3595\n  as: Component = 'div',\n  className,\n  ...props\n}, ref) => {\n  const prefix = useBootstrapPrefix(bsPrefix, 'container');\n  const suffix = typeof fluid === 'string' ? `-${fluid}` : '-fluid';\n  return /*#__PURE__*/_jsx(Component, {\n    ref: ref,\n    ...props,\n    className: classNames(className, fluid ? `${prefix}${suffix}` : prefix)\n  });\n});\nContainer.displayName = 'Container';\nexport default Container;"],"names":["Index","t","useTranslation","keyPrefix","navigate","useNavigate","searchParams","useSearchParams","user","storeUser","update","updateUser","loggedUserInfoStore","_","loginSetting","loginSettingStore","state","login","ucAgent","userCenterStore","agent","ucAgentInfo","enabled","agent_info","canOriginalLogin","enabled_original_user_system","allow_password_login","formData","setFormData","useState","e_mail","value","isInvalid","errorMsg","pass","step","setStep","handleChange","params","passwordCaptcha","useCaptchaPlugin","handleLogin","event","preventDefault","captcha","getCaptcha","verify","captcha_code","captcha_id","then","async","_passwordCaptcha$clos","close","call","res","setupAppTheme","guard","isNotActivated","catch","err","isError","_passwordCaptcha$hand","data","handleFormError","handleCaptchaError","list","ele","document","getElementById","error_field","scrollToElementTop","useEffect","isInactive","get","id","mail_status","usePageTags","title","_jsxs","Container","style","paddingTop","paddingBottom","children","_jsx","WelcomeTitle","Col","className","md","lg","xl","PluginRender","type","PluginType","Captcha","slug_name","Connector","_Fragment","Form","noValidate","onSubmit","_passwordCaptcha$chec","stopPropagation","checkValidated","bol","errObj","Object","keys","filter","key","check","Group","controlId","Label","Control","required","tabIndex","onChange","e","target","Feedback","Link","to","Button","variant","allow_new_registrations","Trans","i18nKey","ns","userCenter","onClick","floppyNavigation","handleRouteLinkClick","Unactivate","visible","React","bsPrefix","fluid","as","Component","props","ref","prefix","useBootstrapPrefix","suffix","classNames","displayName"],"sourceRoot":""}