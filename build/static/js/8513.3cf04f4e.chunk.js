"use strict";(globalThis.webpackChunkanswer_static=globalThis.webpackChunkanswer_static||[]).push([[8513],{58513:(e,l,t)=>{t.r(l),t.d(l,{default:()=>c});var s=t(12162),a=t(98496),r=t(28093),i=t(10428),u=t(45558),n=t(93090),v=t(91374),o=t(49450);const c=()=>{const{t:e}=(0,a.B)("translation",{keyPrefix:"admin.privilege"}),l=(0,r.dj)(),[t,c]=(0,s.useState)(),[d,m]=(0,s.useState)({title:e("title"),properties:{}}),[p,h]=(0,s.useState)({level:{"ui:widget":"select"}}),[b,f]=(0,s.useState)((0,i.pw)(d)),g=l=>{const s=Number(l.level.value),a=null===t||void 0===t?void 0:t.options,r=null===a||void 0===a?void 0:a.find((e=>e.level===s));if(!a||!r)return;const u={level:p.level},n={level:{type:"number",title:e("level.label"),description:e("level.text"),enum:a.map((e=>e.level)),enumNames:a.map((e=>e.level_desc)),default:s}};r.privileges.forEach((l=>{n[l.key]={type:"number",title:l.label,default:l.value},u[l.key]={"ui:options":{readOnly:r.level!==v.N7,validator:l=>{const t=Number(l);return Number.isNaN(t)?e("msg.should_be_number"):!(t<1)||e("msg.number_larger_1")}}}}));const o={...d,properties:n},c=(0,i.pw)(o);r.privileges.forEach((e=>{c[e.key]={value:e.value,isInvalid:!1,errorMsg:""}})),m(o),h(u),f(c)};(0,s.useEffect)((()=>{t&&g({level:{value:t.selected_level,isInvalid:!1,errorMsg:""}})}),[t]),(0,s.useEffect)((()=>{(0,u.k_)().then((e=>{c(e)}))}),[]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("h3",{className:"mb-4",children:e("title")}),(0,o.jsx)(i.q,{schema:d,uiSchema:p,formData:b,onSubmit:t=>{t.preventDefault(),t.stopPropagation();const s={level:Number(b.level.value),custom_privileges:[]};s.level===v.N7&&Object.entries(b).forEach((([e,l])=>{var t;"level"!==e&&(null===(t=s.custom_privileges)||void 0===t||t.push({key:e,value:Number(l.value)}))})),(0,u.Jd)(s).then((()=>{l.onShow({msg:e("update",{keyPrefix:"toast"}),variant:"success"}),s.level===v.N7&&(0,u.k_)().then((e=>{c(e)}))})).catch((e=>{if(e.isError){const l=(0,n.NC)(e,b);f({...l});const t=document.getElementById(e.list[0].error_field);(0,n.qt)(t)}}))},onChange:e=>{var l;e.level.value===v.N7&&(null===b||void 0===b||null===(l=b.level)||void 0===l?void 0:l.value)===e.level.value?f(e):g(e)}})]})}}}]);
//# sourceMappingURL=8513.3cf04f4e.chunk.js.map