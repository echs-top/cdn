{"version":3,"file":"static/js/3950.d00ec8f5.chunk.js","mappings":"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","sources":["pages/Tags/Info/components/MergeTagModal/index.tsx","webpack://answer-static/./src/pages/Tags/Info/components/MergeTagModal/index.scss?02c6"],"sourcesContent":["/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { FC, useState, useEffect, useCallback, useRef } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Form, Dropdown, Modal, Button } from 'react-bootstrap';\n\nimport debounce from 'lodash/debounce';\n\nimport { TagInfo } from '@/common/interface';\nimport { queryTags } from '@/services';\n\nimport './index.scss';\n\nconst DEBOUNCE_DELAY = 400;\n\ninterface Props {\n  visible: boolean;\n  sourceTag: TagInfo;\n  onClose: () => void;\n  onConfirm: (sourceTagID: string, targetTagID: string) => void;\n}\n\ninterface SearchTagResp {\n  tag_id: string;\n  slug_name: string;\n  display_name: string;\n  recommend: boolean;\n  reserved: boolean;\n}\n\nconst MergeTagModal: FC<Props> = ({\n  visible,\n  sourceTag,\n  onClose,\n  onConfirm,\n}) => {\n  const { t } = useTranslation('translation', {\n    keyPrefix: 'tag_info.merge',\n  });\n  const [targetTag, setTargetTag] = useState<SearchTagResp | null>(null);\n  const [searchValue, setSearchValue] = useState('');\n  const [tags, setTags] = useState<SearchTagResp[]>([]);\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [dropdownVisible, setDropdownVisible] = useState(false);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  const searchTags = useCallback(\n    debounce((search) => {\n      if (!search) {\n        setTags([]);\n        return;\n      }\n      queryTags(search).then((res) => {\n        const filteredTags =\n          res.filter((tag) => tag.slug_name !== sourceTag.slug_name) || [];\n        setTags(filteredTags || []);\n        setDropdownVisible(true);\n      });\n    }, DEBOUNCE_DELAY),\n    [],\n  );\n\n  const handleConfirm = () => {\n    if (!targetTag) return;\n    onConfirm(sourceTag.tag_id, targetTag.tag_id);\n  };\n\n  const handleSelect = (tag: SearchTagResp) => {\n    setTargetTag(tag);\n    setDropdownVisible(false);\n    setSearchValue(tag.display_name);\n    inputRef.current?.blur();\n  };\n\n  const handleSearch = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const searchStr = e.currentTarget.value.trim();\n    setSearchValue(searchStr);\n    searchTags(searchStr);\n  };\n\n  const handleBlur = () => {\n    setTimeout(() => {\n      if (!targetTag) {\n        setDropdownVisible(false);\n      }\n    }, 200);\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (!tags.length) return;\n    switch (e.key) {\n      case 'ArrowDown':\n        e.preventDefault();\n        setCurrentIndex((prev) => (prev < tags.length - 1 ? prev + 1 : prev));\n        break;\n      case 'ArrowUp':\n        e.preventDefault();\n        setCurrentIndex((prev) => (prev > 0 ? prev - 1 : prev));\n        break;\n      case 'Enter':\n        e.preventDefault();\n        if (currentIndex >= 0 && currentIndex < tags.length) {\n          handleSelect(tags[currentIndex]);\n        }\n        break;\n      case 'Escape':\n        e.preventDefault();\n        inputRef.current?.blur();\n        setDropdownVisible(false);\n        break;\n      default:\n        break;\n    }\n  };\n\n  useEffect(() => {\n    if (visible) {\n      searchTags('');\n      setSearchValue('');\n      setTargetTag(null);\n      setCurrentIndex(0);\n      setDropdownVisible(false);\n    }\n  }, [visible]);\n\n  return (\n    <Modal show={visible} onCancel={onClose} className=\"mergeTagModal\">\n      <Modal.Header>\n        <Modal.Title>{t('title')}</Modal.Title>\n      </Modal.Header>\n      <Modal.Body>\n        <Form>\n          <Form.Group className=\"mb-3\">\n            <Form.Label>{t('source_tag_title')}</Form.Label>\n            <Form.Control value={sourceTag.display_name} disabled />\n            <Form.Text className=\"text-muted\">\n              {t('source_tag_description')}\n            </Form.Text>\n          </Form.Group>\n          <Form.Group>\n            <Form.Label>{t('target_tag_title')}</Form.Label>\n            <div className=\"position-relative\">\n              <Dropdown\n                show={Boolean(dropdownVisible && searchValue)}\n                onToggle={setDropdownVisible}>\n                <Form.Control\n                  ref={inputRef}\n                  type=\"text\"\n                  value={searchValue}\n                  onChange={handleSearch}\n                  onKeyDown={handleKeyDown}\n                  onBlur={handleBlur}\n                  autoComplete=\"off\"\n                />\n\n                <Dropdown.Menu className=\"w-100\">\n                  {tags.map((tag, index) => (\n                    <Dropdown.Item\n                      key={tag.slug_name}\n                      active={index === currentIndex}\n                      onClick={() => handleSelect(tag)}>\n                      {tag.display_name}\n                    </Dropdown.Item>\n                  ))}\n                  {!tags.length && searchValue && (\n                    <Dropdown.Item disabled>{t('no_results')}</Dropdown.Item>\n                  )}\n                </Dropdown.Menu>\n              </Dropdown>\n            </div>\n            <Form.Text className=\"text-muted\">\n              {t('target_tag_description')}\n            </Form.Text>\n          </Form.Group>\n        </Form>\n      </Modal.Body>\n      <Modal.Footer>\n        <Button variant=\"link\" onClick={onClose}>\n          {t('close', { keyPrefix: 'btns' })}\n        </Button>\n        <Button onClick={handleConfirm} disabled={!targetTag}>\n          {t('submit', { keyPrefix: 'btns' })}\n        </Button>\n      </Modal.Footer>\n    </Modal>\n  );\n};\n\nexport default MergeTagModal;\n","// extracted by mini-css-extract-plugin\nexport default {};"],"names":["MergeTagModal","visible","sourceTag","onClose","onConfirm","t","useTranslation","keyPrefix","targetTag","setTargetTag","useState","searchValue","setSearchValue","tags","setTags","currentIndex","setCurrentIndex","dropdownVisible","setDropdownVisible","inputRef","useRef","searchTags","useCallback","debounce","search","queryTags","then","res","filteredTags","filter","tag","slug_name","handleSelect","_inputRef$current","display_name","current","blur","useEffect","_jsxs","Modal","show","onCancel","className","children","_jsx","Header","Title","Body","Form","Group","Label","Control","value","disabled","Text","Dropdown","Boolean","onToggle","ref","type","onChange","e","searchStr","currentTarget","trim","onKeyDown","_inputRef$current2","length","key","preventDefault","prev","onBlur","handleBlur","setTimeout","autoComplete","Menu","map","index","Item","active","onClick","Footer","Button","variant","handleConfirm","tag_id"],"sourceRoot":""}