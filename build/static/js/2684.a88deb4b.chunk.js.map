{"version":3,"file":"static/js/2684.a88deb4b.chunk.js","mappings":"gQA+BA,MA8HA,EA9HkBA,KAChB,MAAM,EAAEC,IAAMC,EAAAA,EAAAA,GAAe,cAAe,CAC1CC,UAAW,gBAEPC,GAAQC,EAAAA,EAAAA,MAERC,EAAkB,CACtB,CACEC,MAAO,iBACPC,MAAOP,EAAE,4CAEX,CACEM,MAAO,qBACPC,MAAOP,EAAE,iDAIPQ,EAAqB,CACzBC,MAAOT,EAAE,cACTU,SAAU,CAAC,mBAAoB,kBAC/BC,WAAY,CACVC,yBAA0B,CACxBC,KAAM,SACNJ,MAAOT,EAAE,kCACTc,YAAad,EAAE,iCACfe,KAAqB,OAAfV,QAAe,IAAfA,OAAe,EAAfA,EAAiBW,KAAKC,GAASA,EAAKX,QAC1CY,UAA0B,OAAfb,QAAe,IAAfA,OAAe,EAAfA,EAAiBW,KAAKC,GAASA,EAAKV,QAC/CY,QAAS,GAEXC,iBAAkB,CAChBP,KAAM,SACNJ,MAAOT,EAAE,0BACTc,YAAad,EAAE,0BAEjBqB,eAAgB,CACdR,KAAM,SACNJ,MAAOT,EAAE,wBACTc,YAAad,EAAE,2BAqBdsB,EAAUC,IAAeC,EAAAA,EAAAA,WAASC,EAAAA,EAAAA,IAAajB,KAoCtDkB,EAAAA,EAAAA,YAAU,MACRC,EAAAA,EAAAA,MAAkBC,MAAMC,IACtB,GAAIA,EAAS,CACX,MAAMC,EAAW,IAAKR,GACtBQ,EAASlB,yBAAyBN,MAChCuB,EAAQjB,yBACVkB,EAASV,iBAAiBd,MACxBuB,EAAQE,+BACVD,EAAST,eAAef,MAAQuB,EAAQG,6BACxCT,EAAYO,EACd,IACA,GACD,IAMH,OACEG,EAAAA,EAAAA,MAAAC,EAAAA,SAAA,CAAAC,SAAA,EACEC,EAAAA,EAAAA,KAAA,MAAIC,UAAU,OAAMF,SAAEnC,EAAE,iBACxBoC,EAAAA,EAAAA,KAACE,EAAAA,EAAU,CACT9B,OAAQA,EACRc,SAAUA,EACViB,SA1DYC,IAChBA,EAAIC,iBACJD,EAAIE,kBAEJ,MAAMC,EAAqC,CACzC/B,yBAA0BU,EAASV,yBAAyBN,MAC5DyB,+BAAgCT,EAASF,iBAAiBd,MAC1DsC,6BAA8BC,EAAAA,GAAOC,MACnCxB,EAASF,iBAAiBd,OAE5B0B,6BAA8BV,EAASD,eAAef,MACtDyC,2BAA4BF,EAAAA,GAAOC,MAAMxB,EAASD,eAAef,SAGnE0C,EAAAA,EAAAA,IAAgBL,GACbf,MAAK,KACJzB,EAAM8C,OAAO,CACXC,IAAKlD,EAAE,SAAU,CAAEE,UAAW,UAC9BiD,QAAS,YAEXC,EAAAA,GAAcC,WAAWC,OAAO,CAC9B1C,yBAA0B+B,EAAU/B,0BACpC,IAEH2C,OAAOC,IACN,GAAIA,EAAIC,QAAS,CACf,MAAMC,GAAOC,EAAAA,EAAAA,IAAgBH,EAAKlC,GAClCC,EAAY,IAAKmC,IACjB,MAAME,EAAMC,SAASC,eAAeN,EAAIO,KAAK,GAAGC,cAChDC,EAAAA,EAAAA,IAAmBL,EACrB,IACA,EA4BAM,SA9EqB,CACzBtD,yBAA0B,CACxB,YAAa,UAEfQ,iBAAkB,CAChB,YAAa,WACb,aAAc,CACZ+C,KAAM,KAGV9C,eAAgB,CACd,YAAa,WACb,aAAc,CACZ8C,KAAM,MAkENC,SAZkBV,IACtBnC,EAAYmC,EAAK,MAad,C","sources":["pages/Admin/Legal/index.tsx"],"sourcesContent":["/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { FC, useEffect, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nimport { marked } from 'marked';\n\nimport type * as Type from '@/common/interface';\nimport { SchemaForm, JSONSchema, initFormData, UISchema } from '@/components';\nimport { useToast } from '@/hooks';\nimport { getLegalSetting, putLegalSetting } from '@/services';\nimport { handleFormError, scrollToElementTop } from '@/utils';\nimport { siteLealStore } from '@/stores';\n\nconst Legal: FC = () => {\n  const { t } = useTranslation('translation', {\n    keyPrefix: 'admin.legal',\n  });\n  const Toast = useToast();\n\n  const externalContent = [\n    {\n      value: 'always_display',\n      label: t('external_content_display.always_display'),\n    },\n    {\n      value: 'ask_before_display',\n      label: t('external_content_display.ask_before_display'),\n    },\n  ];\n\n  const schema: JSONSchema = {\n    title: t('page_title'),\n    required: ['terms_of_service', 'privacy_policy'],\n    properties: {\n      external_content_display: {\n        type: 'string',\n        title: t('external_content_display.label'),\n        description: t('external_content_display.text'),\n        enum: externalContent?.map((lang) => lang.value),\n        enumNames: externalContent?.map((lang) => lang.label),\n        default: 0,\n      },\n      terms_of_service: {\n        type: 'string',\n        title: t('terms_of_service.label'),\n        description: t('terms_of_service.text'),\n      },\n      privacy_policy: {\n        type: 'string',\n        title: t('privacy_policy.label'),\n        description: t('privacy_policy.text'),\n      },\n    },\n  };\n  const uiSchema: UISchema = {\n    external_content_display: {\n      'ui:widget': 'select',\n    },\n    terms_of_service: {\n      'ui:widget': 'textarea',\n      'ui:options': {\n        rows: 10,\n      },\n    },\n    privacy_policy: {\n      'ui:widget': 'textarea',\n      'ui:options': {\n        rows: 10,\n      },\n    },\n  };\n  const [formData, setFormData] = useState(initFormData(schema));\n\n  const onSubmit = (evt) => {\n    evt.preventDefault();\n    evt.stopPropagation();\n\n    const reqParams: Type.AdminSettingsLegal = {\n      external_content_display: formData.external_content_display.value,\n      terms_of_service_original_text: formData.terms_of_service.value,\n      terms_of_service_parsed_text: marked.parse(\n        formData.terms_of_service.value,\n      ),\n      privacy_policy_original_text: formData.privacy_policy.value,\n      privacy_policy_parsed_text: marked.parse(formData.privacy_policy.value),\n    };\n\n    putLegalSetting(reqParams)\n      .then(() => {\n        Toast.onShow({\n          msg: t('update', { keyPrefix: 'toast' }),\n          variant: 'success',\n        });\n        siteLealStore.getState().update({\n          external_content_display: reqParams.external_content_display,\n        });\n      })\n      .catch((err) => {\n        if (err.isError) {\n          const data = handleFormError(err, formData);\n          setFormData({ ...data });\n          const ele = document.getElementById(err.list[0].error_field);\n          scrollToElementTop(ele);\n        }\n      });\n  };\n\n  useEffect(() => {\n    getLegalSetting().then((setting) => {\n      if (setting) {\n        const formMeta = { ...formData };\n        formMeta.external_content_display.value =\n          setting.external_content_display;\n        formMeta.terms_of_service.value =\n          setting.terms_of_service_original_text;\n        formMeta.privacy_policy.value = setting.privacy_policy_original_text;\n        setFormData(formMeta);\n      }\n    });\n  }, []);\n\n  const handleOnChange = (data) => {\n    setFormData(data);\n  };\n\n  return (\n    <>\n      <h3 className=\"mb-4\">{t('page_title')}</h3>\n      <SchemaForm\n        schema={schema}\n        formData={formData}\n        onSubmit={onSubmit}\n        uiSchema={uiSchema}\n        onChange={handleOnChange}\n      />\n    </>\n  );\n};\n\nexport default Legal;\n"],"names":["Legal","t","useTranslation","keyPrefix","Toast","useToast","externalContent","value","label","schema","title","required","properties","external_content_display","type","description","enum","map","lang","enumNames","default","terms_of_service","privacy_policy","formData","setFormData","useState","initFormData","useEffect","getLegalSetting","then","setting","formMeta","terms_of_service_original_text","privacy_policy_original_text","_jsxs","_Fragment","children","_jsx","className","SchemaForm","onSubmit","evt","preventDefault","stopPropagation","reqParams","terms_of_service_parsed_text","marked","parse","privacy_policy_parsed_text","putLegalSetting","onShow","msg","variant","siteLealStore","getState","update","catch","err","isError","data","handleFormError","ele","document","getElementById","list","error_field","scrollToElementTop","uiSchema","rows","onChange"],"sourceRoot":""}