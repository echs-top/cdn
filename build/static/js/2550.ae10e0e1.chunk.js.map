{"version":3,"file":"static/js/2550.ae10e0e1.chunk.js","mappings":"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","sources":["pages/Admin/Interface/index.tsx"],"sourcesContent":["/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { FC, FormEvent, useEffect, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nimport { useToast } from '@/hooks';\nimport {\n  LangsType,\n  FormDataType,\n  AdminSettingsInterface,\n} from '@/common/interface';\nimport { interfaceStore, loggedUserInfoStore } from '@/stores';\nimport { JSONSchema, SchemaForm, UISchema } from '@/components';\nimport { DEFAULT_TIMEZONE, SYSTEM_AVATAR_OPTIONS } from '@/common/constants';\nimport {\n  updateInterfaceSetting,\n  useInterfaceSetting,\n  getLoggedUserInfo,\n} from '@/services';\nimport {\n  setupAppLanguage,\n  loadLanguageOptions,\n  setupAppTimeZone,\n} from '@/utils/localize';\nimport { handleFormError, scrollToElementTop } from '@/utils';\n\nconst Interface: FC = () => {\n  const { t } = useTranslation('translation', {\n    keyPrefix: 'admin.interface',\n  });\n  const storeInterface = interfaceStore.getState().interface;\n  const Toast = useToast();\n  const [langs, setLangs] = useState<LangsType[]>();\n  const { data: setting } = useInterfaceSetting();\n\n  const schema: JSONSchema = {\n    title: t('page_title'),\n    properties: {\n      language: {\n        type: 'string',\n        title: t('language.label'),\n        description: t('language.text'),\n        enum: langs?.map((lang) => lang.value),\n        enumNames: langs?.map((lang) => lang.label),\n        default:\n          setting?.language || storeInterface.language || langs?.[0]?.value,\n      },\n      time_zone: {\n        type: 'string',\n        title: t('time_zone.label'),\n        description: t('time_zone.text'),\n        default: setting?.time_zone || DEFAULT_TIMEZONE,\n      },\n      default_avatar: {\n        type: 'string',\n        title: t('avatar.label'),\n        description: t('avatar.text'),\n        enum: SYSTEM_AVATAR_OPTIONS?.map((v) => v.value),\n        enumNames: SYSTEM_AVATAR_OPTIONS?.map((v) => v.label),\n        default: setting?.default_avatar || 'system',\n      },\n      gravatar_base_url: {\n        type: 'string',\n        title: t('gravatar_base_url.label'),\n        description: t('gravatar_base_url.text'),\n        default: setting?.gravatar_base_url || '',\n      },\n    },\n  };\n\n  const [formData, setFormData] = useState<FormDataType>({\n    language: {\n      value: setting?.language || storeInterface.language || langs?.[0]?.value,\n      isInvalid: false,\n      errorMsg: '',\n    },\n    time_zone: {\n      value: setting?.time_zone || DEFAULT_TIMEZONE,\n      isInvalid: false,\n      errorMsg: '',\n    },\n    default_avatar: {\n      value: setting?.default_avatar || 'system',\n      isInvalid: false,\n      errorMsg: '',\n    },\n    gravatar_base_url: {\n      value: setting?.gravatar_base_url || '',\n      isInvalid: false,\n      errorMsg: '',\n    },\n  });\n\n  const uiSchema: UISchema = {\n    language: {\n      'ui:widget': 'select',\n    },\n    time_zone: {\n      'ui:widget': 'timezone',\n    },\n    default_avatar: {\n      'ui:widget': 'select',\n    },\n    gravatar_base_url: {\n      'ui:widget': 'input',\n      'ui:options': {\n        placeholder: 'https://www.gravatar.com/avatar/',\n      },\n    },\n  };\n  const getLangs = async () => {\n    const res: LangsType[] = await loadLanguageOptions(true);\n    setLangs(res);\n  };\n\n  const checkValidated = (): boolean => {\n    let ret = true;\n    const { language } = formData;\n    const formCheckData = { ...formData };\n    if (!language.value) {\n      ret = false;\n      formCheckData.language = {\n        value: '',\n        isInvalid: true,\n        errorMsg: t('language.msg'),\n      };\n    }\n    setFormData({\n      ...formCheckData,\n    });\n    return ret;\n  };\n  const onSubmit = (evt: FormEvent) => {\n    evt.preventDefault();\n    evt.stopPropagation();\n    if (checkValidated() === false) {\n      return;\n    }\n    const reqParams: AdminSettingsInterface = {\n      language: formData.language.value,\n      time_zone: formData.time_zone.value,\n      default_avatar: formData.default_avatar.value,\n      gravatar_base_url: formData.gravatar_base_url.value,\n    };\n\n    updateInterfaceSetting(reqParams)\n      .then(() => {\n        interfaceStore.getState().update(reqParams);\n        setupAppLanguage();\n        setupAppTimeZone();\n        getLoggedUserInfo().then((info) => {\n          loggedUserInfoStore.getState().update(info);\n        });\n        Toast.onShow({\n          msg: t('update', { keyPrefix: 'toast' }),\n          variant: 'success',\n        });\n      })\n      .catch((err) => {\n        if (err.isError) {\n          const data = handleFormError(err, formData);\n          setFormData({ ...data });\n          const ele = document.getElementById(err.list[0].error_field);\n          scrollToElementTop(ele);\n        }\n      });\n  };\n\n  useEffect(() => {\n    if (setting) {\n      const formMeta = {};\n      Object.keys(setting).forEach((k) => {\n        let v = setting[k];\n        if (k === 'default_avatar' && !v) {\n          v = 'system';\n        }\n        if (k === 'gravatar_base_url' && !v) {\n          v = '';\n        }\n        formMeta[k] = { ...formData[k], value: v };\n      });\n      setFormData({ ...formData, ...formMeta });\n    }\n  }, [setting]);\n  useEffect(() => {\n    getLangs();\n  }, []);\n\n  const handleOnChange = (data) => {\n    setFormData(data);\n  };\n  return (\n    <>\n      <h3 className=\"mb-4\">{t('page_title')}</h3>\n      <SchemaForm\n        schema={schema}\n        uiSchema={uiSchema}\n        formData={formData}\n        onSubmit={onSubmit}\n        onChange={handleOnChange}\n      />\n    </>\n  );\n};\n\nexport default Interface;\n"],"names":["Interface","_langs$","_langs$2","t","useTranslation","keyPrefix","storeInterface","interfaceStore","getState","interface","Toast","useToast","langs","setLangs","useState","data","setting","useInterfaceSetting","schema","title","properties","language","type","description","enum","map","lang","value","enumNames","label","default","time_zone","DEFAULT_TIMEZONE","default_avatar","SYSTEM_AVATAR_OPTIONS","v","gravatar_base_url","formData","setFormData","isInvalid","errorMsg","useEffect","formMeta","Object","keys","forEach","k","async","res","loadLanguageOptions","getLangs","_jsxs","_Fragment","children","_jsx","className","SchemaForm","uiSchema","placeholder","onSubmit","evt","preventDefault","stopPropagation","checkValidated","ret","formCheckData","reqParams","updateInterfaceSetting","then","update","setupAppLanguage","setupAppTimeZone","getLoggedUserInfo","info","loggedUserInfoStore","onShow","msg","variant","catch","err","isError","handleFormError","ele","document","getElementById","list","error_field","scrollToElementTop","onChange"],"sourceRoot":""}